(()=>{"use strict";var e={887:(e,t,s)=>{s.r(t)},752:function(e,t,s){var i=this&&this.__awaiter||function(e,t,s,i){return new(s||(s=Promise))((function(n,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,o)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.App=void 0;const n=s(496),a=s(186),r=s(582),o=s(638),l=s(229),d=s(366),c=s(534);t.App=class{constructor(e){this.rootElement=e,this.cardType="cars",this.gameDifficulty="8",this.users=[],this.renderAfterUserUpdate=e=>{console.log(this.users),this.header.adjustButtons(),this.scores.updateScore()},this.saveSettings=e=>{e.preventDefault();const t=new FormData(this.gameSettings.element);this.cardType=t.get("type"),this.gameDifficulty=t.get("difficulty"),console.log(this.gameDifficulty),this.game=new l.Game(this.users),this.start()},this.start=()=>i(this,void 0,void 0,(function*(){console.log("fired");const e=yield fetch("./images.json"),t=(yield e.json())[0].images.slice(0,parseInt(this.gameDifficulty,10)).map((e=>`${this.cardType}/${e}`));this.game.newGame(t),window.dispatchEvent(new Event("locationchange"))})),this.database=new a.Database,this.mainElement=document.createElement("main"),this.mainElement.classList.add("main"),this.form=new r.Form(this.users,this.start),this.header=new d.Header(this.form.openForm,this.start,this.users),this.game=new l.Game(this.users),this.about=new n.About,this.scores=new c.Scores(this.users),this.gameSettings=new o.GameSettings,this.gameSettings.element.onsubmit=this.saveSettings,this.rootElement.appendChild(this.header.element),this.rootElement.appendChild(this.mainElement),window.addEventListener("locationchange",(()=>this.renderMainContent())),window.addEventListener("usersupdate",this.renderAfterUserUpdate),0===this.users.length&&this.database.manageDatabase("readonly").then((e=>{this.users=e,console.log("hi"),console.log(this.users),this.renderMainContent()}))}renderMainContent(){if(this.mainElement.innerHTML="",this.mainElement.appendChild(this.form.element),0!==this.users.length)switch(window.location.pathname){case"/about":this.mainElement.appendChild(this.about.element),window.history.replaceState({},"","/");break;case"/game-settings":this.mainElement.appendChild(this.gameSettings.element),window.history.replaceState({},"","/");break;case"/score":this.mainElement.appendChild(this.scores.element),window.history.replaceState({},"","/");break;default:this.mainElement.appendChild(this.game.element),window.history.replaceState({},"","/")}}}},496:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.About=void 0;const i=s(583);class n extends i.BaseComponent{constructor(){super("div",["main__container"]),this.element.innerHTML='\n      <h2 class="main__title">How to play?</h2>\n      <div class="main__block main__block--1">\n        <div class="main__text main__text--register">Register new player in game</div>\n        <img src="image 1.jpg" alt="add user form" class="main__img main__img--add-user">\n      </div>\n      <div class="main__block main__block--2">\n        <div class="main__text main__text--configure">Configure your game settings</div>\n        <img src="image 2.png" alt="settings button" class="main__img main__img--settings">\n      </div>\n      <div class="main__block main__block--3">\n        <div class="main__text main__text--start">\n          Start your new game! Remember card positions and\n          match it before times up.\n        </div>\n        <img src="image 3.png" alt="cards" class="main__img main__img--cards">\n      </div>\n    '}}t.About=n},583:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BaseComponent=void 0,t.BaseComponent=class{constructor(e="div",t=[]){this.element=document.createElement(e),this.element.classList.add(...t)}}},977:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Card=void 0;const i=s(583);class n extends i.BaseComponent{constructor(e){super("div",["main__flip-card"]),this.image=e,this.isFlipped=!1,this.element.innerHTML=`\n      <div class="main__flip-card-inner" id="card-inner">\n        <img src="${e}" class="main__flip-card-side">\n        <img src="image.jpg" class="main__flip-card-side main__flip-card-side--back">\n      </div>`}flipToBack(){this.isFlipped=!0,this.element.classList.add("main__flip-card--flipped")}flipToFront(){this.isFlipped=!1,this.element.classList.remove("main__flip-card--flipped")}markAsCorrect(){this.element.classList.add("main__flip-card--correct")}markAsIncorrect(){this.element.classList.add("main__flip-card--incorrect")}unmark(){this.element.classList.remove("main__flip-card--incorrect")}}t.Card=n},610:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CardsField=void 0;const i=s(583);class n extends i.BaseComponent{constructor(e,t){super("div",["main__cards"]),this.timer=e,this.button=t,this.cards=[],this.timeout=0}clear(){this.cards=[],this.element.innerHTML="",window.clearTimeout(this.timeout)}addCards(e){this.cards=e,this.cards.forEach((e=>this.element.appendChild(e.element))),this.timeout=window.setTimeout((()=>{this.cards.forEach((e=>e.flipToBack())),this.timer.reset(),this.button.style.display="inline-block"}),3e4),this.element.style.gridTemplateColumns=`repeat(${Math.sqrt(this.cards.length)}, 1fr)`}}t.CardsField=n},913:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CongratsModal=void 0;const i=s(583);class n extends i.BaseComponent{constructor(){super("div",["main__container--form"]),this.open=e=>{var t,s,i;this.element.style.display="block",this.element.innerHTML=`\n      <div class="main__congrats-modal">\n      Congratulations! You successfully found all matches on\n      ${e[1].toString().padStart(2,"0")} : ${e[2].toString().padStart(2,"0")} minutes.\n      Your score: ${e[0]}\n      <button class="main__close-modal-button">ok</button>\n      </div>\n    `,console.log(null===(t=this.element.firstElementChild)||void 0===t?void 0:t.lastElementChild),null===(i=null===(s=this.element.firstElementChild)||void 0===s?void 0:s.lastElementChild)||void 0===i||i.addEventListener("click",this.close)},this.close=()=>{window.history.pushState({},"","/score"),window.dispatchEvent(new Event("locationchange")),this.element.style.display="none"},this.element.style.display="none"}}t.CongratsModal=n},186:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Database=void 0,t.Database=class{constructor(){this.manageDatabase=(e="readwrite")=>new Promise(((t,s)=>{const i=window.indexedDB.open("Nasridean",1);i.onsuccess=()=>{const n=i.result,a=n.transaction("users",e);a.objectStore("users").get("0").onsuccess=e=>t(e.target.result),a.onerror=e=>s(e),a.oncomplete=()=>n.close()},i.onerror=e=>s(e),i.onupgradeneeded=e=>i.result.createObjectStore("users")}))}}},582:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Form=void 0;const i=s(583);class n extends i.BaseComponent{constructor(e,t){var s,i,n,a;super("div",["main__container","main__container--form"]),this.users=e,this.start=t,this.reader=new FileReader,this.imgURL="",this.uploadPicture=e=>{const t=new FormData(this.element.firstElementChild);this.reader.onload=e=>{var t,s,i;this.imgURL=null===(t=e.target)||void 0===t?void 0:t.result,(null===(s=this.element.firstElementChild)||void 0===s?void 0:s.children[3]).style.backgroundImage=`url(${null===(i=e.target)||void 0===i?void 0:i.result})`},this.reader.readAsDataURL(t.get("image-input"))},this.addUser=e=>{e.preventDefault(),this.start();const t=this.element.firstElementChild,s=new FormData(t),i=new FileReader,n={id:this.users.length,firstName:s.get("firstName"),lastName:s.get("lastName"),email:s.get("email"),score:0,avatar:this.imgURL||null};if(1===this.reader.readyState){const e=s=>{var i;this.users.push(n),window.dispatchEvent(new Event("usersupdate")),t.reset(),window.dispatchEvent(new Event("locationchange")),null===(i=s.target)||void 0===i||i.removeEventListener("load",e)};return i.addEventListener("load",e),void alert("wait until image is loaded")}this.users.push(n),t.reset(),this.closeForm(e),window.dispatchEvent(new Event("locationchange")),window.dispatchEvent(new Event("usersupdate")),console.log(this.users)},this.closeForm=e=>{e.preventDefault(),this.element.style.display="none"},this.openForm=e=>{e.preventDefault(),this.element.style.display="block"},this.element.innerHTML='\n    <form class="main__form">\n      <legend class="main__title">Register new Player</legend>\n      <input name="firstName" class="main__form-input" type="text" name="firstName" placeholder="First name" pattern="^[^0-9 ~ ! @ # $ % * () _ — + = | : ;  < > , . ? / ^ &#34 &#39 &#96]*$" required>\n      <input id="image-input" name="image-input" class="main__form-image-input" type="file" accept="image/*"<br>\n      <label class="main__form-image-input-label"for="image-input"></label>\n      <input name="lastName" class="main__form-input" type="text" name="lastName" placeholder="Last name" pattern="^[^0-9 ~ ! @ # $ % * () _ — + = | : ;  < > , . ? / ^ &#34 &#39 &#96]*$" required><br>\n      <input name="email" class="main__form-input" type="email" name="email" placeholder="Email" required>\n      <input class="main__add-user-button" type="submit" name="submit" value="Add user">\n      <button class="main__cancel-button">Cancel</button>\n    </form>\n    ',null===(i=null===(s=this.element.firstElementChild)||void 0===s?void 0:s.lastElementChild)||void 0===i||i.addEventListener("click",this.closeForm),null===(n=this.element.firstElementChild)||void 0===n||n.addEventListener("submit",this.addUser),null===(a=this.element.firstElementChild)||void 0===a||a.children[2].addEventListener("input",this.uploadPicture)}}t.Form=n},638:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GameSettings=void 0;const i=s(583);class n extends i.BaseComponent{constructor(){super("form",["main__container","main__container--settings"]),this.element.innerHTML='\n      <fieldset class="main__select-block">\n        <legend class="main__title">Game cards</legend>\n        <select name="type" id="cards-type" class="main__select">\n          <option value="cars" selected>select game cards type</option>\n          <option value="cars">Cars</option>\n          <option value="fruits">Fruits</option>\n        </select>\n      </fieldset>\n      \n      <fieldset class="main__select-block">\n        <legend class="main__title">Difficulty</legend>\n        <select name="difficulty" class="main__select">\n          <option value="8" selected>select game type</option>\n          <option value="8">4x4</option>\n          <option value="18">6x6</option>\n          <option value="32">8x8</option>\n        </select>\n      </fieldset>\n      <input type="submit" name="submit" value="Save" class="main__save-button">\n    '}}t.GameSettings=n},229:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Game=void 0;const i=s(583),n=s(977),a=s(610),r=s(913),o=s(715);class l extends i.BaseComponent{constructor(e){var t;super("div",["main__container","main__container--game"]),this.users=e,this.score=0,this.matchCount=0,this.images=[],this.isAnimation=!1,this.isPaused=!1,this.pauseOrResumeGame=e=>{if(this.isPaused)return e.target.textContent="pause game",this.isPaused=!1,void this.timer.start();e.target.textContent="resume game",this.isPaused=!0,this.timer.stop()},this.element.innerHTML='<button class="main__pause-resume-button" style="display: none">pause game</button>',this.pauseOrResumeButton=this.element.firstElementChild,this.timer=new o.Timer,this.cardsField=new a.CardsField(this.timer,this.pauseOrResumeButton),this.congratsModal=new r.CongratsModal,this.element.appendChild(this.timer.element),this.element.appendChild(this.cardsField.element),this.element.appendChild(this.congratsModal.element),null===(t=this.element.firstElementChild)||void 0===t||t.addEventListener("click",this.pauseOrResumeGame)}newGame(e){this.score=0,this.matchCount=0,this.images=e,this.timer.reset(),this.timer.start(),this.cardsField.clear(),this.pauseOrResumeButton.style.display="none";const t=e.concat(e).map((e=>new n.Card(e))).sort((()=>Math.random()-.5));t.forEach((e=>e.element.addEventListener("click",(()=>this.cardHandler(e))))),this.cardsField.addCards(t)}cardHandler(e){if(!this.isAnimation&&!this.isPaused&&e.isFlipped){if(this.isAnimation=!0,e.flipToFront(),!this.activeCard)return this.activeCard=e,void(this.isAnimation=!1);if(this.activeCard.image!==e.image)return this.score--,this.activeCard.markAsIncorrect(),e.markAsIncorrect(),void setTimeout((()=>{var t,s;null===(t=this.activeCard)||void 0===t||t.flipToBack(),null===(s=this.activeCard)||void 0===s||s.unmark(),e.flipToBack(),e.unmark(),this.activeCard=void 0,this.isAnimation=!1}),1e3);this.score++,this.matchCount++,this.activeCard.markAsCorrect(),e.markAsCorrect(),this.activeCard=void 0,this.isAnimation=!1,this.matchCount===this.images.length&&(this.timer.stop(),this.score=100*this.score-10*(60*this.timer.minutes+this.timer.seconds),this.score=this.score<0?0:this.score,this.users[this.users.length-1].score=this.score,window.dispatchEvent(new Event("usersupdate")),this.congratsModal.open([this.score,this.timer.minutes,this.timer.seconds]),console.log(this.users))}}}t.Game=l},366:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Header=void 0;const i=s(583),n=s(272);class a extends i.BaseComponent{constructor(e,t,s){super("header",["header"]),this.openForm=e,this.start=t,this.users=s,this.adjustButtons=()=>{const e=0===this.users.length;this.startNewGameButton.style.display=e?"none":"inline-block",this.userImageButton.style.display=e?"none":"inline-block",this.registerNewPlayerButton.style.display=e?"inline-block":"none",!e&&this.users[this.users.length-1].avatar&&(this.userImageButton.style.backgroundImage=`url(${this.users[this.users.length-1].avatar})`)},this.createLinks=()=>{var e;(null===(e=this.element.firstElementChild)||void 0===e?void 0:e.lastElementChild)&&(this.element.firstElementChild.lastElementChild.innerHTML="",this.element.firstElementChild.lastElementChild.appendChild(new n.Link(["About game","?"],"about").element),this.element.firstElementChild.lastElementChild.appendChild(new n.Link(["Best scores",""],"score").element),this.element.firstElementChild.lastElementChild.appendChild(new n.Link(["Game settings",""],"game-settings").element))},this.element.innerHTML='\n    <div class="header__left-side">\n      <div class="header__logo">\n        <p>match</p>\n        <p>match</p>\n      </div>\n      <nav class="header__links">\n      </nav>\n    </div>\n    <button class="header__button">Start new game</button>\n    <i class="main__form-image-input-label main__form-image-input-label--header"></i>\n    <button class="header__button" id="button">Register new player</button>\n    ',this.createLinks(),window.addEventListener("locationchange",(()=>{var e;this.createLinks(),"/"!==window.location.pathname&&(null===(e=document.getElementById(window.location.pathname.slice(1)))||void 0===e||e.classList.add("header__link-button--active"))})),this.startNewGameButton=this.element.children[1],this.userImageButton=this.element.children[2],this.registerNewPlayerButton=this.element.lastElementChild,this.startNewGameButton.addEventListener("click",this.start),this.userImageButton.addEventListener("click",this.openForm),this.registerNewPlayerButton.addEventListener("click",this.openForm),this.adjustButtons()}}t.Header=a},272:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Link=void 0;const i=s(583);class n extends i.BaseComponent{constructor(e,t){var s;super("div",["header__link"]),this.innerText=e,this.element.innerHTML=`\n    <button class="header__link-button header__link-button--${t}" id="${t}">\n      <i class="header__icon--${t} header__icon">${e[1]}</i>\n      ${e[0]}\n    </button>\n    `,null===(s=this.element.firstElementChild)||void 0===s||s.addEventListener("click",(()=>{window.history.pushState({},"",`/${t}`),window.dispatchEvent(new Event("locationchange"))}))}}t.Link=n},929:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Score=void 0;const i=s(583);class n extends i.BaseComponent{constructor(e){super("div",["main__player"]),this.user=e,this.element.innerHTML=`\n      <div class="main__credentials">\n        <img src="${e.avatar}" alt="avatar" class="main__avatar">\n        <p class="main__text-credentials">\n          <span class="main__name">${e.firstName}</span><br>\n          <span class="main__email">${e.lastName}</span>\n        </p>\n      </div>\n      <p class="main__score">Score: <span class="main__score-value">${e.score}</span></p>\n    `}}t.Score=n},534:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Scores=void 0;const i=s(583),n=s(929);class a extends i.BaseComponent{constructor(e){super("div",["main__container"]),this.users=e,this.updateScore=()=>{const e=[...this.users];this.element.lastElementChild.innerHTML="";const t=e.sort(((e,t)=>t.score-e.score)).map((e=>new n.Score(e)));t.forEach((e=>{var t;return null===(t=this.element.lastElementChild)||void 0===t?void 0:t.append(e.element)})),console.log(e,t,this.users)},this.element.innerHTML='\n      <h2 class="main__title">Best Players</h2>\n      <div class="main__players"></div>\n    '}}t.Scores=a},715:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Timer=void 0;const i=s(583);class n extends i.BaseComponent{constructor(){super("div",["main__time"]),this.minutes=0,this.seconds=0,this.interval=0,this.start()}render(){this.element.innerHTML=`<p class="main__time-value">\n    ${this.minutes.toString().padStart(2,"0")}:${this.seconds.toString().padStart(2,"0")}\n    </p>`}start(){this.stop(),this.interval=window.setInterval((()=>{59===this.seconds&&(this.seconds=0,this.minutes=++this.minutes),this.seconds=++this.seconds,this.render()}),1e3)}stop(){window.clearInterval(this.interval)}reset(){this.minutes=0,this.seconds=0}}t.Timer=n}},t={};function s(i){var n=t[i];if(void 0!==n)return n.exports;var a=t[i]={exports:{}};return e[i].call(a.exports,a,a.exports,s),a.exports}s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{s(887);const e=s(752);window.onload=()=>{new e.App(document.body).start()}})()})();